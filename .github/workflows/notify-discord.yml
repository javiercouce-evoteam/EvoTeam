name: Discord Notification

on:
  push:
    branches: [main]
  pull_request:
    types: [opened, closed, reopened]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Format and send Discord message
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_GITHUB }}
        run: |
          echo "‚úÖ Evento: ${{ github.event_name }}"

          if [ "${{ github.event_name }}" = "pull_request" ]; then
            curl -H "Content-Type: application/json" \
              -X POST \
              -d '{
                "content": "**üîÄ Nueva Pull Request**",
                "embeds": [
                  {
                    "title": "${{ github.event.pull_request.title }}",
                    "description": "üßë Autor: `${{ github.actor }}`\nüîÅ Rama: `${{ github.head_ref }}`",
                    "url": "${{ github.event.pull_request.html_url }}",
                    "color": 5814783
                  }
                ]
              }' \
              $DISCORD_WEBHOOK
          else
            curl -H "Content-Type: application/json" \
              -X POST \
              -d '{
                "content": "**üì¶ Push a main**",
                "embeds": [
                  {
                    "title": "Commit: ${{ github.event.head_commit.message }}",
                    "description": "üßë Autor: `${{ github.actor }}`\nüîÅ Rama: `${{ github.ref_name }}`",
                    "url": "https://github.com/${{ github.repository }}/commit/${{ github.sha }}",
                    "color": 3066993
                  }
                ]
              }' \
              $DISCORD_WEBHOOK
          fi
